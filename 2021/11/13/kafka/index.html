<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="JSamuel"><title>kafka | JSamuel&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.xml"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!1},style:{primary_color:"#0066CC",avatar:"/images/avatar.svg",favicon:"/images/logo.svg",article_img_align:"left",left_side_width:"260px",content_max_width:"920px",hover:{shadow:!1,scale:!1},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"Welcome to JSamuel's blog"},scroll:{progress_bar:{enable:!0},percent:{enable:!0}}},local_search:{enable:!0,trigger:"auto",unescape:!1,preload:!0},code_copy:{enable:!0,style:"default"},side_tools:{enable:!0},pjax:{enable:!1},lazyload:{enable:!1},version:"3.4.1"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 月前",year:"%s 年前"}</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-title" href="/">JSamuel&#39;s Blog</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/changelog">更新日志</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/changelog">更新日志</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">kafka</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.svg"></div><div class="info"><div class="author"><span class="name">JSamuel</span> <span class="author-label">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-edit"></i>&nbsp;2021-11-13 21:20:33 </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/%E7%AD%94%E8%BE%A9/">答辩</a>&nbsp;</li><li>&gt; <a href="/categories/%E7%AD%94%E8%BE%A9/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/big-data/">big-data</a>&nbsp;</li><li>| <a href="/tags/kafka/">kafka</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>1.6k 字</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>6 分钟</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h2 id="1-作用"><a href="#1-作用" class="headerlink" title="1. 作用"></a>1. 作用</h2><ul><li>削峰填谷</li><li>防止数据丢失</li></ul><h2 id="2-集群"><a href="#2-集群" class="headerlink" title="2. 集群"></a>2. 集群</h2><ul><li>天然支持集群，一个节点也是集群</li><li>注册到同一个zk上，就是同一个集群</li><li>id区分节点</li></ul><h2 id="3-分片"><a href="#3-分片" class="headerlink" title="3. 分片"></a>3. 分片</h2><ul><li>partition（文件类）下有多个segment片段（文件）</li><li>每个segment对应一个.log文件和一个.index文件</li></ul><h3 id="（1）-分片的功能"><a href="#（1）-分片的功能" class="headerlink" title="（1） 分片的功能"></a>（1） 分片的功能</h3><ul><li>负载均衡：均匀地分布在多个broker</li><li>提高读写并发度和吞吐量：消费者</li><li>系统伸缩性： 根据业务量配置集群</li><li>提高集群故障处理能力：分片拆分，只影响一部分数据</li></ul><h3 id="（2）-分片策略"><a href="#（2）-分片策略" class="headerlink" title="（2） 分片策略"></a>（2） 分片策略</h3><ul><li>消息发送分区分配：指定分区 + key（murmur hash） + 轮询</li><li>消费者分区分配：consumer leader负责，也是rebalance过程，分区按照数字顺序排序，消费者按名称的字典序排序<ul><li>RoundRobin:依次顺序分配</li><li>Range:分区总数/消费者数</li></ul></li><li>分区放在哪个节点：master负责，随机挑一个broker放分区0，依次放置其他分区；副本分片基于主分片，按顺序以此方式</li></ul><h3 id="3-分片缺点"><a href="#3-分片缺点" class="headerlink" title="(3) 分片缺点"></a>(3) 分片缺点</h3><ul><li>分片太多，导致集群不可用</li><li>副本数据同步，数据延迟</li><li>需要大量内存，不适合资源紧张的环境</li></ul><h2 id="4-消费者"><a href="#4-消费者" class="headerlink" title="4. 消费者"></a>4. 消费者</h2><ul><li>消费能力横向伸缩性</li><li>容错性/故障容灾</li><li>Rebalance，减少消费抖动（consumer停止消费）</li><li>高性能，一个消费者 =》 多个消费者</li></ul><h2 id="5-副本"><a href="#5-副本" class="headerlink" title="5. 副本"></a>5. 副本</h2><h3 id="（1）-作用"><a href="#（1）-作用" class="headerlink" title="（1） 作用"></a>（1） 作用</h3><ul><li>数据备份，数据恢复，数据高可靠和完整性</li><li>防止单点故障，支持容错</li><li>故障自动转移</li></ul><h3 id="（2）-数据一致性"><a href="#（2）-数据一致性" class="headerlink" title="（2） 数据一致性"></a>（2） 数据一致性</h3><ul><li>对外一致性：领导者副本机制，follower不对外提供服务，follower被动、定期、异步拉取leader数据</li><li>对内一致性：ISR副本集合<ul><li>Follower落后时间，10s</li><li>动态调整</li><li>平衡数据丢失率和吞吐率</li></ul></li><li>复制一致性：leader和follower都commit后，更新到HW，才能对外读取</li></ul><h3 id="（3）-容错性"><a href="#（3）-容错性" class="headerlink" title="（3） 容错性"></a>（3） 容错性</h3><p>broker异常或者退出，分片会把leader切换到ISR中对应的follower节点上，继续对外提供写入服务</p><h3 id="（4）-数据恢复"><a href="#（4）-数据恢复" class="headerlink" title="（4） 数据恢复"></a>（4） 数据恢复</h3><p>follower从leader进行数据同步</p><h3 id="（5）-全部宕机"><a href="#（5）-全部宕机" class="headerlink" title="（5） 全部宕机"></a>（5） 全部宕机</h3><ul><li>等待ISR中的一个恢复，选他为leader：降低可用性</li><li>选择第一个恢复的副本作为leader，无论是否在ISR：数据丢失</li></ul><h3 id="（6）-副本分配"><a href="#（6）-副本分配" class="headerlink" title="（6） 副本分配"></a>（6） 副本分配</h3><p>副本分片基于主分片的选择，按顺序防止</p><h2 id="6-选举"><a href="#6-选举" class="headerlink" title="6. 选举"></a>6. 选举</h2><h3 id="（1）-controller"><a href="#（1）-controller" class="headerlink" title="（1） controller"></a>（1） controller</h3><ul><li>zk中创建临时节点，第一个注册成功的，成为controller</li><li>功能<ul><li>主题管理</li><li>分区重分配</li><li>preferred leader选举</li><li>集群成员管理</li><li>集群元数据</li></ul></li></ul><h3 id="（2）-leader"><a href="#（2）-leader" class="headerlink" title="（2） leader"></a>（2） leader</h3><p>ISR集合，分区选择算法，ISR列表中的第一个</p><h3 id="（3）-消费者选主"><a href="#（3）-消费者选主" class="headerlink" title="（3） 消费者选主"></a>（3） 消费者选主</h3><ul><li>第一个加入消费者组的</li><li>重新分配：随机</li><li>消费者协调器负责选主，主负责分配分片</li></ul><h2 id="7-故障处理"><a href="#7-故障处理" class="headerlink" title="7. 故障处理"></a>7. 故障处理</h2><h3 id="（1）-controller故障"><a href="#（1）-controller故障" class="headerlink" title="（1） controller故障"></a>（1） controller故障</h3><p>选举新的controller，zk注册，第一个注册成功的是controller</p><h3 id="（2）-leader故障"><a href="#（2）-leader故障" class="headerlink" title="（2） leader故障"></a>（2） leader故障</h3><ul><li>controller从ISR列表中选出新的leader</li><li>ISR列表中的第一个</li><li>数据一致性：其余follower，log文件中高于HW的截掉，从新的leader同步数据</li><li>副本数据：controller选一个节点，分配follower</li></ul><h3 id="（3）-follower故障"><a href="#（3）-follower故障" class="headerlink" title="（3） follower故障"></a>（3） follower故障</h3><ul><li>重新从leader同步数据，追上leader（LEO &gt; HW）</li><li>重新加入ISR中</li></ul><h3 id="（4）-写入，主挂了"><a href="#（4）-写入，主挂了" class="headerlink" title="（4） 写入，主挂了"></a>（4） 写入，主挂了</h3><p>重试</p><h3 id="（5）-写入，follower挂了"><a href="#（5）-写入，follower挂了" class="headerlink" title="（5） 写入，follower挂了"></a>（5） 写入，follower挂了</h3><p>从ISR中剔除，等待恢复</p><h3 id="（6）-全部挂了"><a href="#（6）-全部挂了" class="headerlink" title="（6） 全部挂了"></a>（6） 全部挂了</h3><ul><li>非ISR列表中的节点选为leader：数据丢失，对外可用</li><li>ISR列表中第一个恢复的选为leader：数据不丢失，对外不可用</li></ul><h3 id="（7）-异常切换耗时"><a href="#（7）-异常切换耗时" class="headerlink" title="（7） 异常切换耗时"></a>（7） 异常切换耗时</h3><p>leader挂了，zk监听，6s内发现</p><h2 id="8-水平扩展"><a href="#8-水平扩展" class="headerlink" title="8. 水平扩展"></a>8. 水平扩展</h2><ul><li>broker启动/停止：partition再分配</li><li>partition增加/减少：提高/降低并发处理能力</li></ul><h2 id="9-kafka-api"><a href="#9-kafka-api" class="headerlink" title="9. kafka api"></a>9. kafka api</h2><h3 id="（1）-consumer-api升级"><a href="#（1）-consumer-api升级" class="headerlink" title="（1） consumer api升级"></a>（1） consumer api升级</h3><table><thead><tr><th></th><th>旧API</th><th>新API</th></tr></thead><tbody><tr><td>offset</td><td>zk管理</td><td>kafka中的topic管理</td></tr><tr><td>机器连接</td><td>zk</td><td>kafka broker</td></tr><tr><td>consumer group</td><td>多线程，一个线程一个分区</td><td>单线程，非线程安全，轮询的方式；支持单线程和多线程</td></tr><tr><td>心跳</td><td>无</td><td>双线程，用户主线程 + 心跳线程；定期发送心跳请求，确保存活性</td></tr></tbody></table><ul><li>好处<ul><li>旧的API：offset依赖zk，数据量大且消费频繁，zk是瓶颈</li><li>新的API：分片分配，依赖broker coordinate和consumer leader，减少zk依赖</li><li>新的API：增加心跳，减少rebalance</li><li>新的API：可以批量拉取数据</li></ul></li></ul><h3 id="（2）-offset提交"><a href="#（2）-offset提交" class="headerlink" title="（2） offset提交"></a>（2） offset提交</h3><p>kafka中的一个topic，保存每个分区的偏移量。</p><p>更新方式</p><ul><li>自动：at most once，频率5s</li><li>手动，at least once<ul><li>同步提交：失败重试，影响吞吐量</li><li>异步提交：不重试，可回调，注意顺序</li></ul></li></ul><h3 id="（3）-新版本使用方案"><a href="#（3）-新版本使用方案" class="headerlink" title="（3） 新版本使用方案"></a>（3） 新版本使用方案</h3><ul><li>多线程 + 多kafka consumer实例<ul><li>优点：方便实现；速度快，无线程切换；维护分区消费顺序</li><li>缺点：占用更多系统资源；受限于分区数，扩展性差；处理超时</li></ul></li><li>单线程 + 单线程kafka consumer + worker线程池<ul><li>优点：可独立扩展线程数；伸缩性好</li><li>缺点： 实现难度高；难以维护分区消息顺序；处理拉长，不易于位移提交管理</li></ul></li></ul><h2 id="10-数据丢失"><a href="#10-数据丢失" class="headerlink" title="10. 数据丢失"></a>10. 数据丢失</h2><ul><li>leader存储，follower未同步，leader故障，切换，数据丢失</li><li>leader存储，follower同步，未写入磁盘，两个都挂掉，数据丢失</li></ul><h2 id="11-为什么kafka很快"><a href="#11-为什么kafka很快" class="headerlink" title="11. 为什么kafka很快"></a>11. 为什么kafka很快</h2><ul><li>顺序读写：追加到本地磁盘文件末尾</li><li>Page Cache：操作系统的内存而不是JVM空间内存<ul><li>避免Object消耗</li><li>避免GC问题</li></ul></li><li>零拷贝：sendfile方法直接将数据从内核空间的度缓冲区拷贝到内核空间的socket缓冲区，不经过用户空间缓存区</li><li>分区分段 + 索引：segment文件有.index</li><li>批量写入 + 批量压缩，减少网络IO</li></ul><h2 id="12-为什么选择kafka"><a href="#12-为什么选择kafka" class="headerlink" title="12. 为什么选择kafka"></a>12. 为什么选择kafka</h2><p>和RabbitMQ，RocketMQ，FMQ等等相比</p><h3 id="（1）-kafka吞吐高"><a href="#（1）-kafka吞吐高" class="headerlink" title="（1） kafka吞吐高"></a>（1） kafka吞吐高</h3><p>比RabbitMQ高出1-2个数量级</p><ul><li>kafka QPS：百万级</li><li>RabbitMQ QPS：万级</li><li>RocketMQ TPS：7万条/S，阿里</li></ul><h3 id="（2）-数据可靠性"><a href="#（2）-数据可靠性" class="headerlink" title="（2） 数据可靠性"></a>（2） 数据可靠性</h3><p>kafka：多副本，高<br>RabbitMQ：多副本，高<br>RocketMQ：异步实时刷盘/同步刷盘</p><h3 id="（3）-服务可用性"><a href="#（3）-服务可用性" class="headerlink" title="（3） 服务可用性"></a>（3） 服务可用性</h3><p>均有</p><h3 id="（4）-功能"><a href="#（4）-功能" class="headerlink" title="（4） 功能"></a>（4） 功能</h3><p>kafka：适合海量数据收集，适合高吞吐<br>RabbitMQ：支持更多消息队列功能，适合数据一致性，稳定性，高可靠<br>RocketMQ：阿里，交易场景</p><h3 id="（5）-FMQ（2018）"><a href="#（5）-FMQ（2018）" class="headerlink" title="（5） FMQ（2018）"></a>（5） FMQ（2018）</h3><p>适合消息异步订阅，消息队列，一致性，可靠性<br>而不是日志海量存储，高吞吐</p><h2 id="13-zk"><a href="#13-zk" class="headerlink" title="13. zk"></a>13. zk</h2><h3 id="（1）-zk性能"><a href="#（1）-zk性能" class="headerlink" title="（1） zk性能"></a>（1） zk性能</h3><p>tps：1W+ / s，弱</p><h3 id="（2）-zk存储信息"><a href="#（2）-zk存储信息" class="headerlink" title="（2） zk存储信息"></a>（2） zk存储信息</h3><p>集群元信息</p><ul><li>controller数据</li><li>brokers数据<ul><li>每个broker有哪些topic + partition</li><li>leader，ISR等的state状态</li><li>broker的ids，临时节点的ids</li></ul></li><li>消费者不再向zk注册，由消费者协调器统一管理</li></ul></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>本文标题：kafka</li><li>本文作者：JSamuel</li><li>创建时间：2021-11-13 21:20:33</li><li>本文链接：https://huiresurgeran.github.io/2021/11/13/kafka/</li><li>版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2021/11/13/ctsdb/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">ctsdb</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2021/11/11/%E6%A8%A1%E8%B0%83%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"><span class="title flex-center"><span class="post-nav-title-item">模调系统配置</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comment-anchor"></div><div class="comment-area-title"><i class="fas fa-comments">&nbsp;评论</i></div><div class="valine-container"><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script>function loadValine(){new Valine({el:"#vcomments",appId:"G6kz5CJNepsTPKxWkd5BrvjG-gzGzoHsz",appKey:"p0E8ShCVi1HjKLHiXpS9dJIx",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"come on~",lang:"zh-CN".toLowerCase()});const l=setInterval(()=>{var e=document.querySelectorAll("#vcomments .vcards .vcard");if(0<e.length){var a,n="JSamuel";for(a of e){const t=a.querySelector(".vhead .vnick");var r=t.innerHTML;r===n&&(t.innerHTML=`${r} <span class="author">${function(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}(KEEP.hexo_config.language)}</span>`)}clearInterval(l)}else clearInterval(l)},2e3)}{const i=setTimeout(()=>{loadValine(),clearTimeout(i)},1e3)}</script></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span>&nbsp;-&nbsp; 2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">JSamuel</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"><span id="busuanzi_container_site_uv">访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; </span><span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li><li class="go-comment"><i class="fas fa-comment"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class="flex-center" href="/atom.xml" target="_blank"><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BD%9C%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">1. 作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%9B%86%E7%BE%A4"><span class="nav-number">2.</span> <span class="nav-text">2. 集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%88%86%E7%89%87"><span class="nav-number">3.</span> <span class="nav-text">3. 分片</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-%E5%88%86%E7%89%87%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">3.1.</span> <span class="nav-text">（1） 分片的功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-%E5%88%86%E7%89%87%E7%AD%96%E7%95%A5"><span class="nav-number">3.2.</span> <span class="nav-text">（2） 分片策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%88%86%E7%89%87%E7%BC%BA%E7%82%B9"><span class="nav-number">3.3.</span> <span class="nav-text">(3) 分片缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%B6%88%E8%B4%B9%E8%80%85"><span class="nav-number">4.</span> <span class="nav-text">4. 消费者</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%89%AF%E6%9C%AC"><span class="nav-number">5.</span> <span class="nav-text">5. 副本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-%E4%BD%9C%E7%94%A8"><span class="nav-number">5.1.</span> <span class="nav-text">（1） 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7"><span class="nav-number">5.2.</span> <span class="nav-text">（2） 数据一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89-%E5%AE%B9%E9%94%99%E6%80%A7"><span class="nav-number">5.3.</span> <span class="nav-text">（3） 容错性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89-%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="nav-number">5.4.</span> <span class="nav-text">（4） 数据恢复</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89-%E5%85%A8%E9%83%A8%E5%AE%95%E6%9C%BA"><span class="nav-number">5.5.</span> <span class="nav-text">（5） 全部宕机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%886%EF%BC%89-%E5%89%AF%E6%9C%AC%E5%88%86%E9%85%8D"><span class="nav-number">5.6.</span> <span class="nav-text">（6） 副本分配</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E9%80%89%E4%B8%BE"><span class="nav-number">6.</span> <span class="nav-text">6. 选举</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-controller"><span class="nav-number">6.1.</span> <span class="nav-text">（1） controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-leader"><span class="nav-number">6.2.</span> <span class="nav-text">（2） leader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89-%E6%B6%88%E8%B4%B9%E8%80%85%E9%80%89%E4%B8%BB"><span class="nav-number">6.3.</span> <span class="nav-text">（3） 消费者选主</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">7. 故障处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-controller%E6%95%85%E9%9A%9C"><span class="nav-number">7.1.</span> <span class="nav-text">（1） controller故障</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-leader%E6%95%85%E9%9A%9C"><span class="nav-number">7.2.</span> <span class="nav-text">（2） leader故障</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89-follower%E6%95%85%E9%9A%9C"><span class="nav-number">7.3.</span> <span class="nav-text">（3） follower故障</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89-%E5%86%99%E5%85%A5%EF%BC%8C%E4%B8%BB%E6%8C%82%E4%BA%86"><span class="nav-number">7.4.</span> <span class="nav-text">（4） 写入，主挂了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89-%E5%86%99%E5%85%A5%EF%BC%8Cfollower%E6%8C%82%E4%BA%86"><span class="nav-number">7.5.</span> <span class="nav-text">（5） 写入，follower挂了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%886%EF%BC%89-%E5%85%A8%E9%83%A8%E6%8C%82%E4%BA%86"><span class="nav-number">7.6.</span> <span class="nav-text">（6） 全部挂了</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%887%EF%BC%89-%E5%BC%82%E5%B8%B8%E5%88%87%E6%8D%A2%E8%80%97%E6%97%B6"><span class="nav-number">7.7.</span> <span class="nav-text">（7） 异常切换耗时</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95"><span class="nav-number">8.</span> <span class="nav-text">8. 水平扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-kafka-api"><span class="nav-number">9.</span> <span class="nav-text">9. kafka api</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-consumer-api%E5%8D%87%E7%BA%A7"><span class="nav-number">9.1.</span> <span class="nav-text">（1） consumer api升级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-offset%E6%8F%90%E4%BA%A4"><span class="nav-number">9.2.</span> <span class="nav-text">（2） offset提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89-%E6%96%B0%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%A1%88"><span class="nav-number">9.3.</span> <span class="nav-text">（3） 新版本使用方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1"><span class="nav-number">10.</span> <span class="nav-text">10. 数据丢失</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E4%B8%BA%E4%BB%80%E4%B9%88kafka%E5%BE%88%E5%BF%AB"><span class="nav-number">11.</span> <span class="nav-text">11. 为什么kafka很快</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9kafka"><span class="nav-number">12.</span> <span class="nav-text">12. 为什么选择kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-kafka%E5%90%9E%E5%90%90%E9%AB%98"><span class="nav-number">12.1.</span> <span class="nav-text">（1） kafka吞吐高</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="nav-number">12.2.</span> <span class="nav-text">（2） 数据可靠性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89-%E6%9C%8D%E5%8A%A1%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="nav-number">12.3.</span> <span class="nav-text">（3） 服务可用性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89-%E5%8A%9F%E8%83%BD"><span class="nav-number">12.4.</span> <span class="nav-text">（4） 功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89-FMQ%EF%BC%882018%EF%BC%89"><span class="nav-number">12.5.</span> <span class="nav-text">（5） FMQ（2018）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-zk"><span class="nav-number">13.</span> <span class="nav-text">13. zk</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89-zk%E6%80%A7%E8%83%BD"><span class="nav-number">13.1.</span> <span class="nav-text">（1） zk性能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89-zk%E5%AD%98%E5%82%A8%E4%BF%A1%E6%81%AF"><span class="nav-number">13.2.</span> <span class="nav-text">（2） zk存储信息</span></a></li></ol></li></ol></div></div></aside><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/code-copy.js"></script><div class="post-scripts"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/toc.js"></script></div></body></html>