<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="JSamuel"><title>容灾和数据一致性 | JSamuel&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.xml"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!1},style:{primary_color:"#0066CC",avatar:"/images/avatar.svg",favicon:"/images/logo.svg",article_img_align:"left",left_side_width:"260px",content_max_width:"920px",hover:{shadow:!1,scale:!1},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"Welcome to JSamuel's blog"},scroll:{progress_bar:{enable:!0},percent:{enable:!0}}},local_search:{enable:!0,trigger:"auto",unescape:!1,preload:!0},code_copy:{enable:!0,style:"default"},side_tools:{enable:!0},pjax:{enable:!1},lazyload:{enable:!1},version:"3.4.1"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 月前",year:"%s 年前"}</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-title" href="/">JSamuel&#39;s Blog</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/changelog">更新日志</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/changelog">更新日志</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">容灾和数据一致性</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.svg"></div><div class="info"><div class="author"><span class="name">JSamuel</span> <span class="author-label">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-edit"></i>&nbsp;2021-11-10 21:53:45 </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/%E7%AD%94%E8%BE%A9/">答辩</a>&nbsp;</li><li>&gt; <a href="/categories/%E7%AD%94%E8%BE%A9/%E5%AE%B9%E7%81%BE/">容灾</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/disaster-tolerance/">disaster tolerance</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>1.7k 字</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>6 分钟</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h2 id="1-成果"><a href="#1-成果" class="headerlink" title="1. 成果"></a>1. 成果</h2><h3 id="（1）服务部署层面"><a href="#（1）服务部署层面" class="headerlink" title="（1）服务部署层面"></a>（1）服务部署层面</h3><p>服务的多活部署，拥有容灾能力</p><h3 id="（2）低成本容灾"><a href="#（2）低成本容灾" class="headerlink" title="（2）低成本容灾"></a>（2）低成本容灾</h3><p>ng/svr多园区部署<br>L5剔除<br>单机故障演戏</p><h3 id="（3）高成本的未做"><a href="#（3）高成本的未做" class="headerlink" title="（3）高成本的未做"></a>（3）高成本的未做</h3><p>CTSDB/CKV+，外部门，演戏成本高</p><h3 id="（4）无上海机房"><a href="#（4）无上海机房" class="headerlink" title="（4）无上海机房"></a>（4）无上海机房</h3><p>中心设备分布决定<br>满足了深圳多园区的容灾要求</p><h3 id="（5）FMHA"><a href="#（5）FMHA" class="headerlink" title="（5）FMHA"></a>（5）FMHA</h3><p>只存储配置相关的数据，要求不高</p><h3 id="（6）CTSDB-CKV"><a href="#（6）CTSDB-CKV" class="headerlink" title="（6）CTSDB/CKV+"></a>（6）CTSDB/CKV+</h3><p>多园区容灾部署<br>成本考虑</p><h2 id="2-域名解析"><a href="#2-域名解析" class="headerlink" title="2. 域名解析"></a>2. 域名解析</h2><p>DNS解析服务：机器故障，5min剔除，慢</p><h2 id="3-TGW"><a href="#3-TGW" class="headerlink" title="3. TGW"></a>3. TGW</h2><h3 id="（1）自己"><a href="#（1）自己" class="headerlink" title="（1）自己"></a>（1）自己</h3><p>一个集群4台TGW，每台TGW与其他三台TGW实时同步会话信息</p><h3 id="（2）下游服务"><a href="#（2）下游服务" class="headerlink" title="（2）下游服务"></a>（2）下游服务</h3><p>周期性探测server的状态，1min<br>从客服务列表中剔除故障server<br>检测服务恢复正常，自动加回可服务列表</p><h2 id="4-智能网关"><a href="#4-智能网关" class="headerlink" title="4. 智能网关"></a>4. 智能网关</h2><p>多集群部署</p><h3 id="（1）容灾"><a href="#（1）容灾" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><h4 id="自己"><a href="#自己" class="headerlink" title="自己"></a>自己</h4><p>多园区部署<br>深圳主集群，天津灾备</p><h4 id="下游服务"><a href="#下游服务" class="headerlink" title="下游服务"></a>下游服务</h4><ul><li>心跳检测机制</li><li>同一个进程，三次发送到同一个IP的请求均连接失败，就踢掉该IP，请求不会发送到故障服务器</li><li>智能路由转发</li></ul><h3 id="（2）其他功能"><a href="#（2）其他功能" class="headerlink" title="（2）其他功能"></a>（2）其他功能</h3><ul><li>TOF统一身份认证</li><li>鉴权，员工身份信息</li><li>共享登录态</li><li>智能路由转发</li></ul><h2 id="5-nginx"><a href="#5-nginx" class="headerlink" title="5. nginx"></a>5. nginx</h2><p>两地四中心 + 智能网关心跳检测</p><h3 id="（1）上游"><a href="#（1）上游" class="headerlink" title="（1）上游"></a>（1）上游</h3><p>智能网关</p><h3 id="（2）自己"><a href="#（2）自己" class="headerlink" title="（2）自己"></a>（2）自己</h3><p>多园区部署，多城市部署</p><h3 id="（3）下游"><a href="#（3）下游" class="headerlink" title="（3）下游"></a>（3）下游</h3><ul><li>异常重试：4次，服务器列表根据权重轮询</li><li>停止重试：请求时间60S/重试次数4次</li><li>踢掉策略：超时2s，认为失败，踢掉</li><li>恢复策略：屏蔽10s，重新加入存活服务器列表</li></ul><h2 id="6-权限系统"><a href="#6-权限系统" class="headerlink" title="6. 权限系统"></a>6. 权限系统</h2><p>降级登录（探测OA，302次数超过阈值）<br>智能网关开启免登陆</p><h2 id="7-北极星"><a href="#7-北极星" class="headerlink" title="7. 北极星"></a>7. 北极星</h2><h2 id="8-L5"><a href="#8-L5" class="headerlink" title="8. L5"></a>8. L5</h2><h3 id="（1）容灾-1"><a href="#（1）容灾-1" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><h4 id="自己-1"><a href="#自己-1" class="headerlink" title="自己"></a>自己</h4><p>agent挂了，从文件中读取路由信息</p><h4 id="下游"><a href="#下游" class="headerlink" title="下游"></a>下游</h4><ul><li>故障剔除：连续上报10次失败 / 1min失败&gt;50%</li><li>故障恢复：每10s对网络层探测，ok则逐步放量请求</li></ul><h3 id="（2）其他功能-1"><a href="#（2）其他功能-1" class="headerlink" title="（2）其他功能"></a>（2）其他功能</h3><ul><li>负载均衡：空闲状态</li><li>过载保护：回包状态 =》 一个周期内不给服务提供者分配请求</li><li>路由策略：配置 + 权重 + 轮询</li><li>全部服务过载，降级，一个周期内不再返回可用路由</li></ul><h2 id="9-CL5"><a href="#9-CL5" class="headerlink" title="9. CL5"></a>9. CL5</h2><h3 id="（1）容灾-2"><a href="#（1）容灾-2" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><h4 id="故障剔除"><a href="#故障剔除" class="headerlink" title="故障剔除"></a>故障剔除</h4><p>一个周期内，错误率大于某个阈值，或者连续错误多少次，节点故障</p><h4 id="故障恢复"><a href="#故障恢复" class="headerlink" title="故障恢复"></a>故障恢复</h4><p>ping探测宕机节点<br>连通，放少量流量，后逐渐恢复正常</p><h3 id="（2）其他功能-2"><a href="#（2）其他功能-2" class="headerlink" title="（2）其他功能"></a>（2）其他功能</h3><ul><li>负载均衡：静态权重（配置） + 动态权重（成功率，耗时）</li><li>过载保护：降级</li></ul><h2 id="10-openapi-oms网关"><a href="#10-openapi-oms网关" class="headerlink" title="10. openapi/oms网关"></a>10. openapi/oms网关</h2><p>oms网关：多集群部署 + L5切换<br>openapi：两地四中心 + oms网关全量信息</p><h3 id="（1）网关"><a href="#（1）网关" class="headerlink" title="（1）网关"></a>（1）网关</h3><ul><li>网关集群：L5切换</li><li>网关子服务：<ul><li>每套网关多台服务器</li><li>每个网关机器都有全量子服务信息</li></ul></li></ul><h3 id="（2）服务端"><a href="#（2）服务端" class="headerlink" title="（2）服务端"></a>（2）服务端</h3><ul><li>服务注册<ul><li>保存服务信息到本地</li><li>同步协议，同步服务信息到其他网关机器</li><li>子服务从网关同步到其他子服务</li></ul></li><li>心跳检测<ul><li>网关定时检测子服务心跳，剔除无心跳服务</li><li>子服务定期发送心跳</li></ul></li><li>客户端缓存</li></ul><h2 id="11-日志写入服务"><a href="#11-日志写入服务" class="headerlink" title="11. 日志写入服务"></a>11. 日志写入服务</h2><p>两地两中心 + 消费者组机制</p><p>异常重试：CTSDB<br>容灾：消费者组，rebalance</p><h2 id="12-日志查询服务"><a href="#12-日志查询服务" class="headerlink" title="12. 日志查询服务"></a>12. 日志查询服务</h2><p>两地四中心 + nginx配置（故障剔除）</p><p>异常重试：nginx，4次<br>容灾：</p><ul><li>故障剔除：2s，1次</li><li>故障恢复：10s</li></ul><h2 id="13-CTSDB"><a href="#13-CTSDB" class="headerlink" title="13. CTSDB"></a>13. CTSDB</h2><p>支持多地域部署 + 多副本 + 选举</p><h3 id="（1）容灾-3"><a href="#（1）容灾-3" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><ul><li>集群：多园区容灾</li><li>城市：不同地域相互隔离，多园区</li><li>机房：多可用区部署</li><li>单台机器：<ul><li>master：选举，投票（id排序，Bully算法）</li><li>primary：副本 + 选举<ul><li>动态更新 =》 IS列表 =》 master将服务提升为primary（最新的UUID）</li><li>master复制一个副本，分配在节点</li></ul></li><li>replica：同上</li></ul></li></ul><h3 id="（2）数据一致性"><a href="#（2）数据一致性" class="headerlink" title="（2）数据一致性"></a>（2）数据一致性</h3><ul><li>主副本分片：强一致</li><li>写入，主副本都失败，重试</li><li>写入，主成功，备失败<ul><li>强一致：失败，重试</li><li>非强一致：<ul><li>副本故障，移除in-sync</li><li>不对外提供查询，后续异步恢复</li><li>master分配新的副本</li><li>IS存在集群元信息中，master维护</li><li>写入副本失败，从IS中剔除，动态更新IS列表</li></ul></li></ul></li><li>写入，主备都成功，成功</li></ul><h3 id="（3）返回成功，数据没有flush到磁盘"><a href="#（3）返回成功，数据没有flush到磁盘" class="headerlink" title="（3）返回成功，数据没有flush到磁盘"></a>（3）返回成功，数据没有flush到磁盘</h3><p>translog（日志文件） + commit point</p><h3 id="（4）-全部失败"><a href="#（4）-全部失败" class="headerlink" title="（4） 全部失败"></a>（4） 全部失败</h3><p>备份，快照</p><h2 id="14-FMHA"><a href="#14-FMHA" class="headerlink" title="14. FMHA"></a>14. FMHA</h2><p>一地三中心 + 半同步 + 主备切换 + CTSDB</p><h3 id="（1）容灾-4"><a href="#（1）容灾-4" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><ul><li>跨城：名字服务DNS + agent上报心跳</li><li>跨IDC：权重 + 名字服务DNS + agent上报心跳</li><li>跨机：<ul><li>主从切换，权重 + gtid（Global Transaction Identifier，一个事务对应一个GTID，全局唯一）</li><li>数据同步 + 切换</li><li>半同步复制</li></ul></li></ul><h3 id="（2）数据一致性-1"><a href="#（2）数据一致性-1" class="headerlink" title="（2）数据一致性"></a>（2）数据一致性</h3><p>三园区 + 半同步 + GTID + read_only</p><h3 id="（3）卡主"><a href="#（3）卡主" class="headerlink" title="（3）卡主"></a>（3）卡主</h3><p>关闭：主备切换</p><h2 id="15-TDW"><a href="#15-TDW" class="headerlink" title="15. TDW"></a>15. TDW</h2><p>多园区容灾 + 自动恢复 + 任务迁移</p><h2 id="16-CKV"><a href="#16-CKV" class="headerlink" title="16. CKV+"></a>16. CKV+</h2><p>支持多集群部署 + L5切换 + 分片副本 + 主备切换</p><h3 id="（1）容灾-5"><a href="#（1）容灾-5" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><p>副本 + 选举（默认一主一备）<br>副本：默认跨机架，也可跨城</p><ul><li>客户端L5，自动剔除</li><li>集群，跨IDC部署</li><li>城市，跨城部署</li><li>多机器故障：主备分片同时异常，无法切换<ul><li>设备可恢复：本地快照 + 流水</li><li>设备不可恢复：冷备文件回档（每天至少一次冷备，保存三天）</li></ul></li><li>单机器故障<ul><li>故障检测：master发送心跳，2s间隔，10次四百</li><li>设备异常，不可恢复，分片，30s内完成<ul><li>主分片，主备切换</li><li>备份片，重建</li></ul></li><li>设备异常，可恢复<ul><li>秒级恢复，共享内存</li><li>分片状态正常，无操作</li><li>分片状态修改中，异常<ul><li>主分片：剔除主，主备切换</li><li>备份片：剔除备，新建备</li></ul></li></ul></li></ul></li></ul><h3 id="（2）数据一致性-2"><a href="#（2）数据一致性-2" class="headerlink" title="（2）数据一致性"></a>（2）数据一致性</h3><p>异步（默认），强一致（Raft协议，性能损耗大）</p><ul><li>写入<ul><li>主备成功：一致</li><li>主挂了：剔除主，主备切换（数据未同步，丢失）</li><li>备挂了：剔除备，换备</li><li>主备失败：重试</li></ul></li><li>复制中主挂了<ul><li>可恢复：秒级恢复</li><li>不可恢复： 数据丢失</li></ul></li></ul><h3 id="（3）-选举"><a href="#（3）-选举" class="headerlink" title="（3） 选举"></a>（3） 选举</h3><ul><li>master<ul><li>3个节点，不同机房</li><li>创建key，成功则为master</li><li>节点异常，TTL到期，其他Follower抢占</li></ul></li></ul><h2 id="17-kafka"><a href="#17-kafka" class="headerlink" title="17. kafka"></a>17. kafka</h2><p>多集群部署（两地两中心） + 多副本 + 选举</p><h3 id="（1）容灾-6"><a href="#（1）容灾-6" class="headerlink" title="（1）容灾"></a>（1）容灾</h3><p>副本 + 选举</p><ul><li>controller：zk，创建节点</li><li>leader：controller提升副本 + ISR列表（leader维护，zk中也有） + 第一个</li><li>follower：再分配follower</li></ul><h3 id="（2）数据一致性-3"><a href="#（2）数据一致性-3" class="headerlink" title="（2）数据一致性"></a>（2）数据一致性</h3><ul><li>leader失败：重试</li><li>leader成功，fowller失败：异步 + 重试 + ISR</li></ul><h2 id="18-集群-set化作用"><a href="#18-集群-set化作用" class="headerlink" title="18. 集群/set化作用"></a>18. 集群/set化作用</h2><ul><li>流量拆分</li><li>故障隔离</li><li>异地容灾</li></ul></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>本文标题：容灾和数据一致性</li><li>本文作者：JSamuel</li><li>创建时间：2021-11-10 21:53:45</li><li>本文链接：https://huiresurgeran.github.io/2021/11/10/容灾/</li><li>版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2021/11/10/%E6%9C%BA%E5%9E%8B%E5%88%86%E6%9E%90/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">机型分析</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2021/11/10/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E4%B8%80%E8%87%B4%E6%80%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"><span class="title flex-center"><span class="post-nav-title-item">分布式事务一致性解决方案</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comment-anchor"></div><div class="comment-area-title"><i class="fas fa-comments">&nbsp;评论</i></div><div class="valine-container"><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script>function loadValine(){new Valine({el:"#vcomments",appId:"G6kz5CJNepsTPKxWkd5BrvjG-gzGzoHsz",appKey:"p0E8ShCVi1HjKLHiXpS9dJIx",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"come on~",lang:"zh-CN".toLowerCase()});const l=setInterval(()=>{var e=document.querySelectorAll("#vcomments .vcards .vcard");if(0<e.length){var a,n="JSamuel";for(a of e){const t=a.querySelector(".vhead .vnick");var r=t.innerHTML;r===n&&(t.innerHTML=`${r} <span class="author">${function(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}(KEEP.hexo_config.language)}</span>`)}clearInterval(l)}else clearInterval(l)},2e3)}{const i=setTimeout(()=>{loadValine(),clearTimeout(i)},1e3)}</script></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span>&nbsp;-&nbsp; 2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">JSamuel</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"><span id="busuanzi_container_site_uv">访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; </span><span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li><li class="go-comment"><i class="fas fa-comment"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class="flex-center" href="/atom.xml" target="_blank"><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%88%90%E6%9E%9C"><span class="nav-number">1.</span> <span class="nav-text">1. 成果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%B1%82%E9%9D%A2"><span class="nav-number">1.1.</span> <span class="nav-text">（1）服务部署层面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E4%BD%8E%E6%88%90%E6%9C%AC%E5%AE%B9%E7%81%BE"><span class="nav-number">1.2.</span> <span class="nav-text">（2）低成本容灾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E9%AB%98%E6%88%90%E6%9C%AC%E7%9A%84%E6%9C%AA%E5%81%9A"><span class="nav-number">1.3.</span> <span class="nav-text">（3）高成本的未做</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E6%97%A0%E4%B8%8A%E6%B5%B7%E6%9C%BA%E6%88%BF"><span class="nav-number">1.4.</span> <span class="nav-text">（4）无上海机房</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89FMHA"><span class="nav-number">1.5.</span> <span class="nav-text">（5）FMHA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%886%EF%BC%89CTSDB-CKV"><span class="nav-number">1.6.</span> <span class="nav-text">（6）CTSDB&#x2F;CKV+</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">2. 域名解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-TGW"><span class="nav-number">3.</span> <span class="nav-text">3. TGW</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E8%87%AA%E5%B7%B1"><span class="nav-number">3.1.</span> <span class="nav-text">（1）自己</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E4%B8%8B%E6%B8%B8%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.2.</span> <span class="nav-text">（2）下游服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%99%BA%E8%83%BD%E7%BD%91%E5%85%B3"><span class="nav-number">4.</span> <span class="nav-text">4. 智能网关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE"><span class="nav-number">4.1.</span> <span class="nav-text">（1）容灾</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%B7%B1"><span class="nav-number">4.1.1.</span> <span class="nav-text">自己</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E6%B8%B8%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.2.</span> <span class="nav-text">下游服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="nav-number">4.2.</span> <span class="nav-text">（2）其他功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-nginx"><span class="nav-number">5.</span> <span class="nav-text">5. nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E4%B8%8A%E6%B8%B8"><span class="nav-number">5.1.</span> <span class="nav-text">（1）上游</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E8%87%AA%E5%B7%B1"><span class="nav-number">5.2.</span> <span class="nav-text">（2）自己</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E4%B8%8B%E6%B8%B8"><span class="nav-number">5.3.</span> <span class="nav-text">（3）下游</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F"><span class="nav-number">6.</span> <span class="nav-text">6. 权限系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%8C%97%E6%9E%81%E6%98%9F"><span class="nav-number">7.</span> <span class="nav-text">7. 北极星</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-L5"><span class="nav-number">8.</span> <span class="nav-text">8. L5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE-1"><span class="nav-number">8.1.</span> <span class="nav-text">（1）容灾</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%B7%B1-1"><span class="nav-number">8.1.1.</span> <span class="nav-text">自己</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E6%B8%B8"><span class="nav-number">8.1.2.</span> <span class="nav-text">下游</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD-1"><span class="nav-number">8.2.</span> <span class="nav-text">（2）其他功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-CL5"><span class="nav-number">9.</span> <span class="nav-text">9. CL5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE-2"><span class="nav-number">9.1.</span> <span class="nav-text">（1）容灾</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E5%89%94%E9%99%A4"><span class="nav-number">9.1.1.</span> <span class="nav-text">故障剔除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D"><span class="nav-number">9.1.2.</span> <span class="nav-text">故障恢复</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD-2"><span class="nav-number">9.2.</span> <span class="nav-text">（2）其他功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-openapi-oms%E7%BD%91%E5%85%B3"><span class="nav-number">10.</span> <span class="nav-text">10. openapi&#x2F;oms网关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E7%BD%91%E5%85%B3"><span class="nav-number">10.1.</span> <span class="nav-text">（1）网关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">10.2.</span> <span class="nav-text">（2）服务端</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E6%97%A5%E5%BF%97%E5%86%99%E5%85%A5%E6%9C%8D%E5%8A%A1"><span class="nav-number">11.</span> <span class="nav-text">11. 日志写入服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E6%97%A5%E5%BF%97%E6%9F%A5%E8%AF%A2%E6%9C%8D%E5%8A%A1"><span class="nav-number">12.</span> <span class="nav-text">12. 日志查询服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-CTSDB"><span class="nav-number">13.</span> <span class="nav-text">13. CTSDB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE-3"><span class="nav-number">13.1.</span> <span class="nav-text">（1）容灾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7"><span class="nav-number">13.2.</span> <span class="nav-text">（2）数据一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E8%BF%94%E5%9B%9E%E6%88%90%E5%8A%9F%EF%BC%8C%E6%95%B0%E6%8D%AE%E6%B2%A1%E6%9C%89flush%E5%88%B0%E7%A3%81%E7%9B%98"><span class="nav-number">13.3.</span> <span class="nav-text">（3）返回成功，数据没有flush到磁盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89-%E5%85%A8%E9%83%A8%E5%A4%B1%E8%B4%A5"><span class="nav-number">13.4.</span> <span class="nav-text">（4） 全部失败</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-FMHA"><span class="nav-number">14.</span> <span class="nav-text">14. FMHA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE-4"><span class="nav-number">14.1.</span> <span class="nav-text">（1）容灾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7-1"><span class="nav-number">14.2.</span> <span class="nav-text">（2）数据一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%8D%A1%E4%B8%BB"><span class="nav-number">14.3.</span> <span class="nav-text">（3）卡主</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-TDW"><span class="nav-number">15.</span> <span class="nav-text">15. TDW</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-CKV"><span class="nav-number">16.</span> <span class="nav-text">16. CKV+</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE-5"><span class="nav-number">16.1.</span> <span class="nav-text">（1）容灾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7-2"><span class="nav-number">16.2.</span> <span class="nav-text">（2）数据一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89-%E9%80%89%E4%B8%BE"><span class="nav-number">16.3.</span> <span class="nav-text">（3） 选举</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-kafka"><span class="nav-number">17.</span> <span class="nav-text">17. kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%B9%E7%81%BE-6"><span class="nav-number">17.1.</span> <span class="nav-text">（1）容灾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7-3"><span class="nav-number">17.2.</span> <span class="nav-text">（2）数据一致性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-%E9%9B%86%E7%BE%A4-set%E5%8C%96%E4%BD%9C%E7%94%A8"><span class="nav-number">18.</span> <span class="nav-text">18. 集群&#x2F;set化作用</span></a></li></ol></div></div></aside><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/code-copy.js"></script><div class="post-scripts"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.1/source/js/toc.js"></script></div></body></html>